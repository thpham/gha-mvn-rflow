spring:
  application:
    name: myproject-api

server:
  port: 8080

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  # Metrics Configuration
  metrics:
    distribution:
      # Enable histogram buckets for percentile calculations
      percentiles-histogram:
        http.server.requests: true
      # Standard SLO buckets for latency monitoring
      slo:
        http.server.requests: 5ms, 10ms, 25ms, 50ms, 100ms, 250ms, 500ms, 1s, 2500ms, 5s, 10s
    tags:
      # Add application and environment labels to all metrics
      application: ${spring.application.name}
      namespace: ${NAMESPACE:local}

  # OpenTelemetry Resource Attributes
  opentelemetry:
    resource-attributes:
      service.name: ${spring.application.name}
      service.version: ${project.version:0.1.0-SNAPSHOT}
      deployment.environment: ${DEPLOYMENT_ENV:local}

  # Tracing Configuration
  tracing:
    enabled: true
    sampling:
      # 100% sampling for demo; use 0.1 (10%) in production
      probability: 1.0

  # OTLP Export Configuration
  otlp:
    tracing:
      # Endpoint for OTLP collector (e.g., Jaeger, Tempo, or OTel Collector)
      endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4318/v1/traces}
    metrics:
      export:
        url: ${OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:http://localhost:4318/v1/metrics}
        step: 30s
        enabled: ${OTEL_METRICS_EXPORT_ENABLED:false}
    logs:
      export:
        # Endpoint for OTLP log export (e.g., Loki via OTel Collector)
        endpoint: ${OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:http://localhost:4318/v1/logs}

# Pyroscope Profiling Configuration
# Profiles are pushed to Pyroscope server for continuous profiling
pyroscope:
  agent:
    enabled: ${PYROSCOPE_ENABLED:false}
    application-name: ${spring.application.name}
    server-address: ${PYROSCOPE_SERVER_ADDRESS:http://localhost:4040}
    # Profile types: cpu, alloc, lock, wall
    profiling-interval: 10ms
    upload-interval: 15s
    labels:
      environment: ${DEPLOYMENT_ENV:local}
      service: ${spring.application.name}

# Logging configuration
# Note: Log pattern and OTEL export defined in logback-spring.xml
# The OpenTelemetry SDK autoconfigure reads these environment variables for log export:
#   OTEL_LOGS_EXPORTER=otlp (default is 'none', must be set to enable)
#   OTEL_EXPORTER_OTLP_LOGS_ENDPOINT=http://localhost:3100/otlp/v1/logs (Loki OTLP endpoint)
#   OTEL_SERVICE_NAME=${spring.application.name}
logging:
  level:
    # Debug logging for tracing (demo only)
    io.micrometer.tracing: ${TRACE_LOG_LEVEL:INFO}
    io.opentelemetry: ${OTEL_LOG_LEVEL:INFO}
    com.example.myproject: DEBUG

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method
